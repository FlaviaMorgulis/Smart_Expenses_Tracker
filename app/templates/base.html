<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}SmartExpensesTracker{% endblock %}</title>

    <!-- Original CSS -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    {% block head %}{% endblock %}
  </head>
  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="brand">
          <div class="logo">ðŸ’°</div>
          <h1>
            <a
              href="{{ url_for('main.index') }}"
              style="text-decoration: none; color: inherit"
              >SmartExpensesTracker</a
            >
          </h1>
        </div>

        <div class="nav-links">
          {% if current_user.is_authenticated %}
          <!-- Logged in users -->
          <a href="{{ url_for('main.dashboard') }}" class="nav-link">Home</a>
          <a href="{{ url_for('main.family_management') }}" class="nav-link">Family</a>
          <div class="user-menu">
            <h3 class="user-name">Financial Overview</h3>
            <div class="user-dropdown">
            <a href="{{ url_for('transactions.transactions') }}" class="nav-link"
            >Transactions</a>
            <a href="{{ url_for('main.budget') }}" class="nav-link">Budget</a>
            <a href="{{ url_for('main.cash_flow') }}" class="nav-link">Cashflow</a>
            </div>
          </div>
          <div class="user-menu">
            <span class="user-name">{{ current_user.user_name }}</span>
            <div class="user-dropdown">
              <a href="{{ url_for('main.profile') }}">Profile</a>
              <a href="{{ url_for('main.about') }}" class="nav-link">About Us</a>
              <a href="{{ url_for('main.faq') }}" class="nav-link">FAQ</a>
              <a href="{{ url_for('auth.logout') }}">Logout</a>
            </div>
          </div>
          {% else %}
          <!-- Not logged in users - ONLY About -->
          <a href="{{ url_for('main.index') }}" class="nav-link">Home</a>
          <a href="{{ url_for('main.about') }}" class="nav-link">About Us</a>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <div class="flash-messages">
        {% for category, message in messages %}
        <div class="flash-message {{ category }}">
            <span class="flash-text">{{ message }}</span>
            <button class="flash-close" onclick="closeFlashMessage(this)">&times;</button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="wrapper">{% block content %}{% endblock %}</main>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>&copy; 2025 SmartExpensesTracker. All rights reserved.</p>
      </div>
    </footer>

    <!-- External JS -->
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/members.js') }}"></script>
  </body>
</html>

<script>
// Flash message close function
function closeFlashMessage(button) {
    const flashMessage = button.closest('.flash-message');
    if (flashMessage) {
        flashMessage.classList.add('hiding');
        setTimeout(() => {
            flashMessage.remove();
            // Remove container if all flash messages are closed
            const flashContainer = document.querySelector('.flash-messages');
            if (flashContainer && flashContainer.children.length === 0) {
                flashContainer.remove();
            }
        }, 300);
    }
}

// Auto close functionality
function autoCloseFlashMessages() {
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(message => {
        setTimeout(() => {
            if (message.parentNode) {
                closeFlashMessage(message.querySelector('.flash-close'));
            }
        }, 5000); // Auto close after 5 seconds
    });
}

// Functions to run when page loads
document.addEventListener('DOMContentLoaded', function() {
    autoCloseFlashMessages();
    
    // Also check modal close functions here
    initModalCloseFunctions();
});

// Modal close functions
function initModalCloseFunctions() {
    // Close modal by clicking outside
    window.onclick = function(event) {
        const modals = document.querySelectorAll('.modal');
        modals.forEach(modal => {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
    }
    
    // Close modal with ESC key
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }
    });
}

// General close function - for all closeable elements
function setupCloseButtons() {
    // Flash message close buttons
    document.querySelectorAll('.flash-close').forEach(button => {
        button.onclick = function() {
            closeFlashMessage(this);
        };
    });
    
    // Modal close buttons
    document.querySelectorAll('.modal-close, .close-btn').forEach(button => {
        button.onclick = function() {
            const modal = this.closest('.modal');
            if (modal) {
                modal.style.display = 'none';
            }
        };
    });
}

// Set up all close buttons when page loads
document.addEventListener('DOMContentLoaded', setupCloseButtons);
</script>

<style>
/* ================================
   BASE.HTML RESPONSIVE STYLES
   ================================ */

/* Navigation Responsive */
@media (max-width: 768px) {
  .nav-container {
    flex-direction: column;
    gap: 1rem;
    padding: 0 1rem;
  }
  
  .nav-links {
    flex-direction: column;
    width: 100%;
    gap: 0.5rem;
  }
  
  .nav-link {
    text-align: center;
    padding: 0.75rem;
    width: 100%;
    box-sizing: border-box;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .user-menu {
    width: 100%;
    text-align: center;
  }
  
  .user-name {
    width: 100%;
    display: block;
    box-sizing: border-box;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .user-dropdown {
    position: static;
    width: 100%;
    display: none;
    box-shadow: none;
    border: 1px solid var(--border);
  }
  
  .user-menu:hover .user-dropdown,
  .user-menu:focus-within .user-dropdown {
    display: block;
  }
  
  .brand {
    flex-direction: column;
    text-align: center;
    gap: 0.5rem;
  }
  
  .brand h1 {
    font-size: 1.3rem;
  }
}

/* Flash Messages Responsive */
@media (max-width: 768px) {
  .flash-messages {
    position: relative;
    top: auto;
    right: auto;
    width: 100%;
    padding: 0 1rem;
    margin-bottom: 1rem;
  }
  
  .flash-message {
    min-width: auto;
    width: 100%;
    margin-bottom: 0.5rem;
  }
}

/* Main Wrapper Responsive */
@media (max-width: 768px) {
  .wrapper {
    padding: 15px;
    margin-top: 0;
  }
}

/* Footer Responsive */
@media (max-width: 768px) {
  .footer-content {
    padding: 0 1rem;
  }
  
  .footer p {
    font-size: 0.9rem;
  }
}

/* Mobile (480px ve altÄ±) */
@media (max-width: 480px) {
  .nav-container {
    padding: 0 0.5rem;
  }
  
  .brand h1 {
    font-size: 1.2rem;
  }
  
  .logo {
    width: 50px;
    height: 50px;
  }
  
  .flash-messages {
    padding: 0 0.5rem;
  }
  
  .wrapper {
    padding: 10px;
  }
}

/* Tablet (768px - 1024px) */
@media (min-width: 769px) and (max-width: 1024px) {
  .nav-container {
    padding: 0 1.5rem;
  }
  
  .nav-links {
    gap: 1rem;
  }
}

/* Touch Device Improvements */
@media (hover: none) and (pointer: coarse) {
  .user-dropdown {
    display: none;
  }
  
  .user-menu:focus-within .user-dropdown,
  .user-menu.active .user-dropdown {
    display: block;
  }
  
  .nav-link:hover {
    background: transparent;
  }
}

/* Landscape Mobile */
@media (max-height: 500px) and (orientation: landscape) {
  .navbar {
    padding: 0.5rem 0;
  }
  
  .nav-links {
    flex-direction: row;
    flex-wrap: wrap;
  }
  
  .user-menu {
    width: auto;
  }
}
</style>
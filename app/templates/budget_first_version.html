{% extends "base.html" %} {% block title %}Budget - SmartExpensesTracker{%
endblock %} {% block page_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/budget.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <div class="dashboard-content">
    <!-- Page Header -->
    <div class="welcome-section">
      <h1>Budget Management ðŸ’°</h1>
      <p class="lead">Track and manage your spending budgets</p>
    </div>

    <!-- Analytics Overview -->
    <div class="analytics-overview">
      <div class="analytics-card total-budget">
        <div class="card-icon">
          <i class="fas fa-wallet"></i>
        </div>
        <div class="card-content">
          <h3>Total Budget</h3>
          <div class="amount">${{ total_budget or 2500 }}</div>
          <div class="period">This month</div>
        </div>
      </div>

      <div class="analytics-card spent-amount">
        <div class="card-icon">
          <i class="fas fa-credit-card"></i>
        </div>
        <div class="card-content">
          <h3>Total Spent</h3>
          <div class="amount">${{ monthly_spent or 1850 }}</div>
          <div class="period">This month</div>
        </div>
      </div>

      <div class="analytics-card remaining">
        <div class="card-icon">
          <i class="fas fa-piggy-bank"></i>
        </div>
        <div class="card-content">
          <h3>Remaining</h3>
          <div class="amount">
            ${{ (total_budget or 2500) - (monthly_spent or 1850) }}
          </div>
          <div class="period">Available to spend</div>
        </div>
      </div>

      <div class="analytics-card budget-health">
        <div class="card-icon">
          <i class="fas fa-chart-line"></i>
        </div>
        <div class="card-content">
          <h3>Budget Health</h3>
          <div class="health-status good">
            {% set percentage = budget_percentage or ((monthly_spent or 1850) /
            (total_budget or 2500) * 100) %} {% if percentage <= 70 %}
            <span class="status-text good">Good</span>
            {% elif percentage <= 90 %}
            <span class="status-text warning">Warning</span>
            {% else %}
            <span class="status-text danger">Over Budget</span>
            {% endif %}
          </div>
          <div class="percentage">{{ "%.1f"|format(percentage) }}% used</div>
        </div>
      </div>
    </div>

    <!-- Spending Trends -->
    <div class="trends-section">
      <h3>
        <i class="fas fa-chart-bar"></i>
        Spending Trends
      </h3>
      <div class="trends-container">
        {% set sample_trends = [ {'month': 'Jan', 'spent': 1200, 'budget':
        2000}, {'month': 'Feb', 'spent': 1800, 'budget': 2000}, {'month': 'Mar',
        'spent': 1650, 'budget': 2200}, {'month': 'Apr', 'spent': 1850,
        'budget': 2500} ] %} {% for trend in trends or sample_trends %}
        <div class="trend-item">
          <div class="trend-month">{{ trend.month }}</div>
          <div class="trend-bar">
            {% set trend_percentage = (trend.spent / (trend.budget if
            trend.budget > 0 else 1000) * 100) %}
            <div
              class="trend-bar-fill"
              style="height: {{ trend_percentage if trend_percentage <= 100 else 100 }}%"
            ></div>
          </div>
          <div class="trend-amount">${{ trend.spent }}</div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Budget Progress -->
    <div class="budget-progress-section">
      <h3>
        <i class="fas fa-tasks"></i>
        Monthly Budget Progress
      </h3>
      <div class="progress-container">
        <div class="progress-info">
          <span class="spent-amount">${{ monthly_spent or 1850 }} spent</span>
          <span class="budget-amount"
            >of ${{ total_budget or 2500 }} budget</span
          >
        </div>
        <div class="progress-bar">
          {% set progress_percentage = budget_percentage or ((monthly_spent or
          1850) / (total_budget or 2500) * 100) %}
          <div
            class="progress-fill"
            style="width: {{ progress_percentage if progress_percentage <= 100 else 100 }}%"
          ></div>
        </div>
        <div class="progress-percentage">
          {{ "%.1f"|format(budget_percentage or ((monthly_spent or 1850) /
          (total_budget or 2500) * 100)) }}%
        </div>
      </div>
    </div>

    <!-- Category Budgets -->
    <div class="category-budgets-section">
      <div class="section-header">
        <h3>
          <i class="fas fa-list"></i>
          Category Budgets
        </h3>
        <button class="btn btn-primary" onclick="showAddBudgetModal()">
          <i class="fas fa-plus"></i>
          Add Budget
        </button>
      </div>

      <div class="budgets-grid">
        {% if budgets %} {% for category_name, data in budgets.items() %}
        <div class="budget-card">
          <div class="budget-header">
            <div class="category-info">
              <h4>{{ category_name }}</h4>
              <div class="budget-amount">${{ data.budget }}</div>
            </div>
            <div class="budget-actions">
              <button
                class="btn-icon edit"
                onclick="editBudget('{{ category_name }}', {{ data.budget }})"
                title="Edit Budget"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn-icon delete"
                onclick="deleteBudget('{{ category_name }}')"
                title="Delete Budget"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="budget-progress">
            <div class="progress-info">
              <span class="spent">${{ data.spent or 0 }} spent</span>
              <span class="remaining"
                >${{ data.budget - (data.spent or 0) }} left</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill {{ 'over-budget' if (data.percentage or 0) > 100 else '' }}"
                style="width: {{ data.percentage if data.percentage <= 100 else 100 }}%"
              ></div>
            </div>
            <div class="progress-percentage">
              {{ "%.1f"|format(data.percentage or 0) }}%
            </div>
          </div>

          {% if data.percentage > 90 %}
          <div class="budget-alert">
            {% if data.percentage > 100 %}
            <i class="fas fa-exclamation-triangle"></i>
            Over budget by ${{ (data.spent or 0) - data.budget }} {% else %}
            <i class="fas fa-exclamation-circle"></i>
            Approaching budget limit {% endif %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% else %}
        <!-- Sample Budget Cards for Demo -->
        {% set sample_budgets = [ {'name': 'Food & Dining', 'budget': 800,
        'spent': 650, 'percentage': 81.25}, {'name': 'Transportation', 'budget':
        300, 'spent': 245, 'percentage': 81.67}, {'name': 'Entertainment',
        'budget': 200, 'spent': 180, 'percentage': 90}, {'name': 'Shopping',
        'budget': 400, 'spent': 320, 'percentage': 80}, {'name': 'Healthcare',
        'budget': 250, 'spent': 125, 'percentage': 50}, {'name': 'Utilities',
        'budget': 350, 'spent': 330, 'percentage': 94.29} ] %} {% for budget in
        sample_budgets %}
        <div class="budget-card">
          <div class="budget-header">
            <div class="category-info">
              <h4>{{ budget.name }}</h4>
              <div class="budget-amount">${{ budget.budget }}</div>
            </div>
            <div class="budget-actions">
              <button
                class="btn-icon edit"
                onclick="editBudget('{{ budget.name }}', {{ budget.budget }})"
                title="Edit Budget"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn-icon delete"
                onclick="deleteBudget('{{ budget.name }}')"
                title="Delete Budget"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="budget-progress">
            <div class="progress-info">
              <span class="spent">${{ budget.spent }} spent</span>
              <span class="remaining"
                >${{ budget.budget - budget.spent }} left</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill {{ 'over-budget' if budget.percentage > 100 else '' }}"
                style="width: {{ budget.percentage if budget.percentage <= 100 else 100 }}%"
              ></div>
            </div>
            <div class="progress-percentage">
              {{ "%.1f"|format(budget.percentage) }}%
            </div>
          </div>

          {% if budget.percentage > 90 %}
          <div class="budget-alert">
            {% if budget.percentage > 100 %}
            <i class="fas fa-exclamation-triangle"></i>
            Over budget by ${{ budget.spent - budget.budget }} {% else %}
            <i class="fas fa-exclamation-circle"></i>
            Approaching budget limit {% endif %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Add Budget Modal -->
<div id="addBudgetModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Category Budget</h3>
      <span class="close" onclick="closeAddBudgetModal()">&times;</span>
    </div>
    <form id="addBudgetForm" onsubmit="addBudget(event)">
      <div class="form-group">
        <label for="budgetCategory">Category</label>
        <select id="budgetCategory" name="category" required>
          <option value="">Select a category</option>
          <option value="Food & Dining">Food & Dining</option>
          <option value="Transportation">Transportation</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Shopping">Shopping</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Utilities">Utilities</option>
          <option value="Education">Education</option>
          <option value="Travel">Travel</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="budgetAmount">Budget Amount ($)</label>
        <input
          type="number"
          id="budgetAmount"
          name="amount"
          min="0"
          step="0.01"
          placeholder="Enter budget amount"
          required
        />
      </div>
      <div class="form-group">
        <label for="budgetPeriod">Budget Period</label>
        <select id="budgetPeriod" name="period">
          <option value="monthly">Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <div class="modal-actions">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="closeAddBudgetModal()"
        >
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i>
          Add Budget
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Budget Modal -->
<div id="editBudgetModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Budget</h3>
      <span class="close" onclick="closeEditBudgetModal()">&times;</span>
    </div>
    <form id="editBudgetForm" onsubmit="updateBudget(event)">
      <input type="hidden" id="editBudgetCategory" name="category" />
      <div class="form-group">
        <label for="editBudgetAmount">Budget Amount ($)</label>
        <input
          type="number"
          id="editBudgetAmount"
          name="amount"
          min="0"
          step="0.01"
          required
        />
      </div>
      <div class="form-group">
        <label for="editBudgetPeriod">Budget Period</label>
        <select id="editBudgetPeriod" name="period">
          <option value="monthly">Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <div class="modal-actions">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="closeEditBudgetModal()"
        >
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i>
          Update Budget
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Budget Modal Functions
  function showAddBudgetModal() {
    document.getElementById("addBudgetModal").style.display = "block";
  }

  function closeAddBudgetModal() {
    document.getElementById("addBudgetModal").style.display = "none";
    document.getElementById("addBudgetForm").reset();
  }

  function showEditBudgetModal() {
    document.getElementById("editBudgetModal").style.display = "block";
  }

  function closeEditBudgetModal() {
    document.getElementById("editBudgetModal").style.display = "none";
    document.getElementById("editBudgetForm").reset();
  }

  function editBudget(category, amount) {
    document.getElementById("editBudgetCategory").value = category;
    document.getElementById("editBudgetAmount").value = amount;
    showEditBudgetModal();
  }

  function addBudget(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const category = formData.get("category");
    const amount = formData.get("amount");
    const period = formData.get("period");

    console.log("Adding budget:", { category, amount, period });
    alert("Budget for " + category + " added successfully!");
    closeAddBudgetModal();
  }

  function updateBudget(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const category = formData.get("category");
    const amount = formData.get("amount");
    const period = formData.get("period");

    console.log("Updating budget:", { category, amount, period });
    alert("Budget for " + category + " updated successfully!");
    closeEditBudgetModal();
  }

  function deleteBudget(category) {
    if (
      confirm(
        "Are you sure you want to delete the budget for " + category + "?"
      )
    ) {
      console.log("Deleting budget for:", category);
      alert("Budget for " + category + " deleted successfully!");
    }
  }

  // Close modals when clicking outside
  window.onclick = function (event) {
    const addModal = document.getElementById("addBudgetModal");
    const editModal = document.getElementById("editBudgetModal");

    if (event.target === addModal) {
      closeAddBudgetModal();
    }
    if (event.target === editModal) {
      closeEditBudgetModal();
    }
  };

  // Initialize page
  document.addEventListener("DOMContentLoaded", function () {
    // Animate analytics cards
    const analyticsCards = document.querySelectorAll(".analytics-card");
    analyticsCards.forEach((card, index) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(30px)";
      setTimeout(() => {
        card.style.transition = "all 0.6s ease-out";
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, index * 150);
    });

    // Animate trend bars
    const trendBars = document.querySelectorAll(".trend-bar-fill");
    trendBars.forEach((bar, index) => {
      const height = bar.style.height;
      bar.style.height = "0%";
      setTimeout(() => {
        bar.style.transition = "height 1s ease-in-out";
        bar.style.height = height;
      }, 700 + index * 200);
    });

    // Animate budget cards
    const budgetCards = document.querySelectorAll(".budget-card");
    budgetCards.forEach((card, index) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(20px)";
      setTimeout(() => {
        card.style.transition = "all 0.5s ease-in-out";
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, index * 100);
    });
  });
</script>

{% endblock %}

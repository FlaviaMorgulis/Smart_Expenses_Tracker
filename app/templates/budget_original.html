{% extends "base.html" %} {% block title %}Budget - SmartExpensesTracker{%
endblock %} {% block page_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/budget.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-container">
  <div class="dashboard-content">
    <!-- Page Header -->
    <div class="welcome-section">
      <h1>Budget Management ðŸ’°</h1>
      <p class="lead">Track and manage your spending budgets</p>
    </div>

    <!-- Budget Overview Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">ðŸŽ¯</div>
        <div class="stat-info">
          <h3>TOTAL BUDGET</h3>
          <h2 class="stat-amount">
            Â£{{ "%.2f"|format(total_budget or 2500) }}
          </h2>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ðŸ’¸</div>
        <div class="stat-info">
          <h3>SPENT THIS MONTH</h3>
          <h2 class="stat-amount negative">
            Â£{{ "%.2f"|format(monthly_spent or 1850) }}
          </h2>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-icon">ðŸ’³</div>
        <div class="stat-info">
          <h3>REMAINING</h3>
          <h2
            class="stat-amount {% if (total_budget or 2500) - (monthly_spent or 1850) > 0 %}positive{% else %}negative{% endif %}"
          >
            Â£{{ "%.2f"|format((total_budget or 2500) - (monthly_spent or 1850))
            }}
          </h2>
        </div>
      </div>
    </div>

    <!-- Budget Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <div class="chart-header">
          <h3>Budget Overview</h3>
        </div>
        <div class="chart-content">
          <div class="donut-chart">
            <div class="percentage">74.0%</div>
            <div class="label">Used</div>
          </div>
        </div>
      </div>

      <div class="chart-container">
        <div class="chart-header">
          <h3>6-Month Spending Trend</h3>
        </div>
        <div class="chart-content">
          <div class="trend-bars">
            <div class="bar" style="height: 60%"></div>
            <div class="bar" style="height: 70%"></div>
            <div class="bar" style="height: 55%"></div>
            <div class="bar" style="height: 65%"></div>
            <div class="bar" style="height: 80%"></div>
            <div class="bar active" style="height: 74%"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Budget Management Section -->
    <div class="budget-management">
      <div class="section-header">
        <h2>Budget Management</h2>
        <button class="btn btn-primary" onclick="showAddBudgetModal()">
          <i class="fas fa-plus"></i> Add Category Budget
        </button>
      </div>

      <!-- Category Budgets Grid -->
      <div class="category-budgets">
        {% if budgets %} {% for category_name, data in budgets.items() %}
        <div class="budget-item">
          <div class="budget-header">
            <div class="category-info">
              <h3>{{ category_name }}</h3>
              <div class="budget-amount">Â£{{ data.budget }}</div>
            </div>
            <div class="budget-actions">
              <button
                class="btn-icon edit"
                onclick="editBudget('{{ category_name }}', {{ data.budget }})"
                title="Edit Budget"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn-icon delete"
                onclick="deleteBudget('{{ category_name }}')"
                title="Delete Budget"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="budget-progress">
            <div class="progress-info">
              <span class="spent">Â£{{ data.spent or 0 }} spent</span>
              <span class="remaining"
                >Â£{{ data.budget - (data.spent or 0) }} remaining</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill {{ 'over-budget' if (data.percentage or 0) > 100 else '' }}"
                style="width: {{ data.percentage if data.percentage <= 100 else 100 }}%"
              ></div>
            </div>
            <div class="progress-text">
              {{ "%.1f"|format(data.percentage or 0) }}% of budget used
            </div>
          </div>

          {% if data.percentage > 90 %}
          <div class="budget-alert">
            {% if data.percentage > 100 %}
            <i class="fas fa-exclamation-triangle"></i>
            Over budget by Â£{{ (data.spent or 0) - data.budget }} {% else %}
            <i class="fas fa-exclamation-circle"></i>
            Approaching budget limit {% endif %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% else %}
        <!-- Sample Budget Items for Demo -->
        {% set sample_budgets = [ {'name': 'Food & Dining', 'budget': 800,
        'spent': 650, 'percentage': 81.25}, {'name': 'Transportation', 'budget':
        300, 'spent': 245, 'percentage': 81.67}, {'name': 'Entertainment',
        'budget': 200, 'spent': 180, 'percentage': 90}, {'name': 'Shopping',
        'budget': 400, 'spent': 320, 'percentage': 80}, {'name': 'Healthcare',
        'budget': 250, 'spent': 125, 'percentage': 50}, {'name': 'Utilities',
        'budget': 350, 'spent': 330, 'percentage': 94.29} ] %} {% for budget in
        sample_budgets %}
        <div class="budget-item">
          <div class="budget-header">
            <div class="category-info">
              <h3>{{ budget.name }}</h3>
              <div class="budget-amount">Â£{{ budget.budget }}</div>
            </div>
            <div class="budget-actions">
              <button
                class="btn-icon edit"
                onclick="editBudget('{{ budget.name }}', {{ budget.budget }})"
                title="Edit Budget"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button
                class="btn-icon delete"
                onclick="deleteBudget('{{ budget.name }}')"
                title="Delete Budget"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>

          <div class="budget-progress">
            <div class="progress-info">
              <span class="spent">Â£{{ budget.spent }} spent</span>
              <span class="remaining"
                >Â£{{ budget.budget - budget.spent }} remaining</span
              >
            </div>
            <div class="progress-bar">
              <div
                class="progress-fill {{ 'over-budget' if budget.percentage > 100 else '' }}"
                style="width: {{ budget.percentage if budget.percentage <= 100 else 100 }}%"
              ></div>
            </div>
            <div class="progress-text">
              {{ "%.1f"|format(budget.percentage) }}% of budget used
            </div>
          </div>

          {% if budget.percentage > 90 %}
          <div class="budget-alert">
            {% if budget.percentage > 100 %}
            <i class="fas fa-exclamation-triangle"></i>
            Over budget by Â£{{ budget.spent - budget.budget }} {% else %}
            <i class="fas fa-exclamation-circle"></i>
            Approaching budget limit {% endif %}
          </div>
          {% endif %}
        </div>
        {% endfor %} {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Add Budget Modal -->
<div id="addBudgetModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Add Category Budget</h3>
      <span class="close" onclick="closeAddBudgetModal()">&times;</span>
    </div>
    <form id="addBudgetForm" onsubmit="addBudget(event)">
      <div class="form-group">
        <label for="budgetCategory">Category</label>
        <select id="budgetCategory" name="category" required>
          <option value="">Select a category</option>
          <option value="Food & Dining">Food & Dining</option>
          <option value="Transportation">Transportation</option>
          <option value="Entertainment">Entertainment</option>
          <option value="Shopping">Shopping</option>
          <option value="Healthcare">Healthcare</option>
          <option value="Utilities">Utilities</option>
          <option value="Education">Education</option>
          <option value="Travel">Travel</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="budgetAmount">Budget Amount (Â£)</label>
        <input
          type="number"
          id="budgetAmount"
          name="amount"
          min="0"
          step="0.01"
          placeholder="Enter budget amount"
          required
        />
      </div>
      <div class="form-group">
        <label for="budgetPeriod">Budget Period</label>
        <select id="budgetPeriod" name="period">
          <option value="monthly">Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <div class="modal-actions">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="closeAddBudgetModal()"
        >
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> Add Budget
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Edit Budget Modal -->
<div id="editBudgetModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Edit Budget</h3>
      <span class="close" onclick="closeEditBudgetModal()">&times;</span>
    </div>
    <form id="editBudgetForm" onsubmit="updateBudget(event)">
      <input type="hidden" id="editBudgetCategory" name="category" />
      <div class="form-group">
        <label for="editBudgetAmount">Budget Amount (Â£)</label>
        <input
          type="number"
          id="editBudgetAmount"
          name="amount"
          min="0"
          step="0.01"
          required
        />
      </div>
      <div class="form-group">
        <label for="editBudgetPeriod">Budget Period</label>
        <select id="editBudgetPeriod" name="period">
          <option value="monthly">Monthly</option>
          <option value="weekly">Weekly</option>
          <option value="yearly">Yearly</option>
        </select>
      </div>
      <div class="modal-actions">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="closeEditBudgetModal()"
        >
          Cancel
        </button>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> Update Budget
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  // Modal Functions
  function showAddBudgetModal() {
    document.getElementById("addBudgetModal").style.display = "block";
  }

  function closeAddBudgetModal() {
    document.getElementById("addBudgetModal").style.display = "none";
    document.getElementById("addBudgetForm").reset();
  }

  function showEditBudgetModal() {
    document.getElementById("editBudgetModal").style.display = "block";
  }

  function closeEditBudgetModal() {
    document.getElementById("editBudgetModal").style.display = "none";
    document.getElementById("editBudgetForm").reset();
  }

  function editBudget(category, amount) {
    document.getElementById("editBudgetCategory").value = category;
    document.getElementById("editBudgetAmount").value = amount;
    showEditBudgetModal();
  }

  function addBudget(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const category = formData.get("category");
    const amount = formData.get("amount");
    const period = formData.get("period");

    console.log("Adding budget:", { category, amount, period });
    alert("Budget for " + category + " added successfully!");
    closeAddBudgetModal();
  }

  function updateBudget(event) {
    event.preventDefault();
    const formData = new FormData(event.target);
    const category = formData.get("category");
    const amount = formData.get("amount");
    const period = formData.get("period");

    console.log("Updating budget:", { category, amount, period });
    alert("Budget for " + category + " updated successfully!");
    closeEditBudgetModal();
  }

  function deleteBudget(category) {
    if (
      confirm(
        "Are you sure you want to delete the budget for " + category + "?"
      )
    ) {
      console.log("Deleting budget for:", category);
      alert("Budget for " + category + " deleted successfully!");
    }
  }

  // Close modal when clicking outside
  window.onclick = function (event) {
    const addModal = document.getElementById("addBudgetModal");
    const editModal = document.getElementById("editBudgetModal");

    if (event.target === addModal) {
      closeAddBudgetModal();
    }
    if (event.target === editModal) {
      closeEditBudgetModal();
    }
  };

  // Initialize page animations
  document.addEventListener("DOMContentLoaded", function () {
    // Animate stat cards
    const statCards = document.querySelectorAll(".stat-card");
    statCards.forEach((card, index) => {
      card.style.opacity = "0";
      card.style.transform = "translateY(20px)";
      setTimeout(() => {
        card.style.transition = "all 0.5s ease";
        card.style.opacity = "1";
        card.style.transform = "translateY(0)";
      }, index * 100);
    });

    // Animate budget items
    const budgetItems = document.querySelectorAll(".budget-item");
    budgetItems.forEach((item, index) => {
      item.style.opacity = "0";
      item.style.transform = "translateX(-20px)";
      setTimeout(() => {
        item.style.transition = "all 0.5s ease";
        item.style.opacity = "1";
        item.style.transform = "translateX(0)";
      }, 500 + index * 100);
    });
  });
</script>

{% endblock %}
